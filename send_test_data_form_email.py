#!/usr/bin/env python3
"""
Send test data collection form to client (–ê–ª–µ–∫—Å–∞–Ω–¥—Ä)
All content in Russian, no attachments per requirements
"""

import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
import os
from datetime import datetime

def send_test_form_email(app_password):
    """Send test data collection form to –ê–ª–µ–∫—Å–∞–Ω–¥—Ä"""
    
    sender_email = "olegmalkov2023@gmail.com"
    recipient_email = "a1538800@gmail.com"
    cc_email = "olegmalkov2023@gmail.com"
    
    # Create message
    msg = MIMEMultipart()
    msg['From'] = sender_email
    msg['To'] = recipient_email
    msg['Cc'] = cc_email
    msg['Subject'] = "–§–æ—Ä–º–∞ —Å–±–æ—Ä–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞"
    
    # Read the form content
    form_path = '/home/vmuser/dev/lh_calc/CLIENT_DATA_COLLECTION_FORM_VERIFIED.md'
    with open(form_path, 'r', encoding='utf-8') as f:
        form_content = f.read()
    
    # Email body - ALL IN RUSSIAN
    body = f"""–£–≤–∞–∂–∞–µ–º—ã–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä,

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–±—Ä–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–∞—à–µ–≥–æ Excel —Ñ–∞–π–ª–∞.

–ú—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ —Ñ–æ—Ä–º—É, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–µ –∂–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∫–∞–∫ –≤ –≤–∞—à–µ–º Excel —Ñ–∞–π–ª–µ "–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –¢–ï–ü–õ–û–ë–õ–û–ö —à–∞–±–ª–æ–Ω –¥–ª—è —Å–Ω–∞–±–∂–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è 7".

–ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨:
1. –í—ã–±–µ—Ä–∏—Ç–µ 3-5 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π —Ç–µ–ø–ª–æ–æ–±–º–µ–Ω–Ω–∏–∫–æ–≤ –∏–∑ –≤–∞—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏
2. –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ª–∏—Å—Ç "—Ç–µ—Ö–Ω–æ–ª–æ–≥") 
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–Ω–∞–±–∂–µ–Ω–∏—è (–ª–∏—Å—Ç "—Å–Ω–∞–±–∂–µ–Ω–∏–µ")
   - –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ª–∏—Å—Ç "—Ä–µ–∑—É–ª—å—Ç–∞—Ç")
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—É—é —Ñ–æ—Ä–º—É –æ–±—Ä–∞—Ç–Ω–æ

–í–ê–ñ–ù–´–ï –ú–û–ú–ï–ù–¢–´:
‚úÖ –í—Å–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π —Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç Excel
‚úÖ –í—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —è—á–µ–π–∫–∏ —É–∫–∞–∑–∞–Ω—ã (D27, E27 –∏ —Ç.–¥.)
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–æ–ª–µ–π
‚úÖ –§–æ—Ä–º–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –Ω–∞ 100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ Excel

–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–≤–æ–ª—è—Ç –Ω–∞–º:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
- –£–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—É–ª
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å 100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ Excel

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–ö4-150, 10-50 –ø–ª–∞—Å—Ç–∏–Ω)
- –°—Ä–µ–¥–Ω—é—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–ö4-750, 300-500 –ø–ª–∞—Å—Ç–∏–Ω)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–ö4-1200, 800-1000 –ø–ª–∞—Å—Ç–∏–Ω)
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏ (–ö4-500*250, –ö4-1200*600)

---
–§–û–†–ú–ê –î–õ–Ø –ó–ê–ü–û–õ–ù–ï–ù–ò–Ø:
---

{form_content}

---

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
–ö–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ LH Calculator

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å:
Email: olegmalkov2023@gmail.com
"""
    
    msg.attach(MIMEText(body, 'plain', 'utf-8'))
    
    # Send email
    try:
        with smtplib.SMTP('smtp.gmail.com', 587) as server:
            server.starttls()
            server.login(sender_email, app_password)
            
            # Send to both recipient and CC
            recipients = [recipient_email, cc_email]
            server.send_message(msg)
            
            print(f"‚úÖ –§–æ—Ä–º–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
            print(f"   –ö–æ–º—É: {recipient_email}")
            print(f"   –ö–æ–ø–∏—è: {cc_email}")
            print(f"   –í—Ä–µ–º—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
            
            # Log to communications folder
            log_path = f"/home/vmuser/dev/lh_calc/communications/{datetime.now().strftime('%Y-%m-%d')}_test_form_sent.md"
            with open(log_path, 'w', encoding='utf-8') as f:
                f.write(f"""# –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ–æ—Ä–º–∞ —Å–±–æ—Ä–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–î–∞—Ç–∞**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
**–ö–æ–º—É**: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä <{recipient_email}>
**–ö–æ–ø–∏—è**: {cc_email}
**–¢–µ–º–∞**: –§–æ—Ä–º–∞ —Å–±–æ—Ä–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ–æ—Ä–º–∞ CLIENT_DATA_COLLECTION_FORM_VERIFIED.md –¥–ª—è —Å–±–æ—Ä–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel —Ñ–∞–π–ª–∞ –∫–ª–∏–µ–Ω—Ç–∞.

–§–æ—Ä–º–∞ –≤–∫–ª—é—á–∞–µ—Ç:
- 3 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- –í—Å–µ –ø–æ–ª—è –∏–∑ –ª–∏—Å—Ç–æ–≤ —Ç–µ—Ö–Ω–æ–ª–æ–≥, —Å–Ω–∞–±–∂–µ–Ω–∏–µ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –¢–æ—á–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ —è—á–µ–π–∫–∏ –∏–∑ Excel
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–æ–≤—ã–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º

## –°—Ç–∞—Ç—É—Å

‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
""")
            
            return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {e}")
        return False

if __name__ == "__main__":
    print("–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã —Å–±–æ—Ä–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö")
    print("-" * 40)
    
    # Check for .env file
    env_path = '/home/vmuser/dev/lh_calc/lh-calculator/.env'
    if os.path.exists(env_path):
        with open(env_path, 'r') as f:
            for line in f:
                if line.startswith('GMAIL_APP_PASSWORD='):
                    app_pwd = line.split('=')[1].strip()
                    if send_test_form_email(app_pwd):
                        print("\nüìß –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
                        print("–û–∂–∏–¥–∞–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞.")
                    else:
                        print("\n‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É.")
                    break
    else:
        app_pwd = input("–í–≤–µ–¥–∏—Ç–µ Gmail app password: ")
        if send_test_form_email(app_pwd):
            print("\nüìß –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
            print("–û–∂–∏–¥–∞–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞.")
        else:
            print("\n‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É.")