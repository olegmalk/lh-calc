<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LH Calculator API</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .header p {
            color: #718096;
            font-size: 14px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: #2d3748;
            font-size: 18px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-healthy { background: #48bb78; }
        .status-warning { background: #ed8936; }
        .status-error { background: #f56565; }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #718096;
            font-size: 14px;
        }
        
        .metric-value {
            color: #2d3748;
            font-weight: 600;
            font-size: 14px;
        }
        
        .demo-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }
        
        .demo-section h2 {
            color: #2d3748;
            font-size: 20px;
            margin-bottom: 20px;
        }
        
        .form-section {
            margin-bottom: 24px;
        }
        
        .form-section h3 {
            color: #4a5568;
            font-size: 16px;
            margin-bottom: 12px;
            padding: 8px;
            background: #f7fafc;
            border-radius: 6px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            color: #4a5568;
            font-size: 12px;
            margin-bottom: 4px;
            font-weight: 600;
        }
        
        .form-group input, .form-group select {
            padding: 8px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        
        .form-group select {
            cursor: pointer;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn-secondary:hover {
            background: #cbd5e0;
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-success:hover {
            background: #38a169;
        }
        
        .response-area {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 16px;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #718096;
        }
        
        .loading.active {
            display: block;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: #48bb78;
            transition: width 0.3s ease;
        }
        
        .error-message {
            background: #fff5f5;
            border: 1px solid #feb2b2;
            color: #c53030;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
            display: none;
        }
        
        .error-message.active {
            display: block;
        }
        
        .file-list {
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #e2e8f0;
            transition: background 0.2s;
        }
        
        .file-item:hover {
            background: #f7fafc;
        }
        
        .file-item:last-child {
            border-bottom: none;
        }
        
        .file-info {
            flex: 1;
            min-width: 0;
        }
        
        .file-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 14px;
            margin-bottom: 4px;
            word-break: break-all;
        }
        
        .file-meta {
            font-size: 12px;
            color: #718096;
        }
        
        .file-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .download-btn {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            white-space: nowrap;
        }
        
        .download-btn:hover {
            background: #5a67d8;
        }
        
        .download-section {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 16px;
            border-top: 2px solid #e2e8f0;
            margin: -24px;
            margin-top: 20px;
            border-radius: 0 0 12px 12px;
            display: none;
        }
        
        .download-section.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .download-section {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                margin: 0;
                z-index: 1000;
                box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
                border-radius: 12px 12px 0 0;
            }
            
            .container {
                padding-bottom: 100px;
            }
            
            .file-name {
                font-size: 12px;
            }
            
            .download-btn {
                padding: 10px 20px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔧 LH Calculator API</h1>
            <p>Heat Exchanger Cost Calculation System with Excel Processing</p>
        </div>
        
        <div class="grid">
            <div class="card">
                <h2><span class="status-indicator status-healthy" id="healthStatus"></span> Health Status</h2>
                <div id="healthMetrics">
                    <div class="metric">
                        <span class="metric-label">Loading...</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>📊 System Metrics</h2>
                <div id="systemMetrics">
                    <div class="metric">
                        <span class="metric-label">Loading...</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>🔧 Admin Tools</h2>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <a href="/template-upload.html" style="
                        display: inline-block;
                        padding: 12px 20px;
                        background: #667eea;
                        color: white;
                        text-decoration: none;
                        border-radius: 8px;
                        font-weight: 600;
                        text-align: center;
                        transition: background 0.3s ease;
                    " onmouseover="this.style.background='#5a67d8'" onmouseout="this.style.background='#667eea'">
                        📋 Template Management →
                    </a>
                    <p style="font-size: 12px; color: #718096; margin: 0;">
                        Upload, download, and manage Excel calculation templates
                    </p>
                </div>
            </div>
            
            <div class="card">
                <h2>📁 Recent Files</h2>
                <div id="recentFiles">
                    <div class="metric">
                        <span class="metric-label">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>🚀 Calculate Heat Exchanger Cost</h2>
            
            <!-- ТЕХНОЛОГ Fields -->
            <div class="form-section">
                <h3>🔧 Technical Parameters (технолог)</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="tech_D27_type">D27 Equipment Type</label>
                        <input type="number" id="tech_D27_type" value="1001">
                    </div>
                    <div class="form-group">
                        <label title="tech_E27_weightType">E27 Equipment Code</label>
                        <input type="text" id="tech_E27_weightType" value="Е-113">
                    </div>
                    <div class="form-group">
                        <label title="tech_F27_quantityType">F27 Delivery Type</label>
                        <select id="tech_F27_quantityType">
                            <option value="Целый ТА" selected>Целый ТА</option>
                            <option value="ШОТ-БЛОК">ШОТ-БЛОК</option>
                            <option value="РЕИНЖ">РЕИНЖ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label title="tech_G27_quantityType">G27 Equipment Size</label>
                        <input type="text" id="tech_G27_quantityType" value="К4-750">
                    </div>
                    <div class="form-group">
                        <label title="tech_H27_quantityType">H27 Process Spec</label>
                        <input type="text" id="tech_H27_quantityType" value="1/6">
                    </div>
                    <div class="form-group">
                        <label title="tech_I27_quantityType">I27 Plate Count</label>
                        <input type="number" id="tech_I27_quantityType" value="401">
                    </div>
                    <div class="form-group">
                        <label title="tech_J27_quantityType">J27 Pressure Bar</label>
                        <input type="number" id="tech_J27_quantityType" value="22">
                    </div>
                    <div class="form-group">
                        <label title="tech_K27_quantity">K27 Pressure Bar</label>
                        <input type="number" id="tech_K27_quantity" value="23">
                    </div>
                    <div class="form-group">
                        <label title="tech_L27_quantity">L27 Temperature °C</label>
                        <input type="number" id="tech_L27_quantity" value="101">
                    </div>
                    <div class="form-group">
                        <label title="tech_M27_material">M27 Temperature °C</label>
                        <input type="number" id="tech_M27_material" value="102">
                    </div>
                    <div class="form-group">
                        <label title="tech_P27_materialType">P27 Plate Material</label>
                        <select id="tech_P27_materialType">
                            <option value="AISI 316L" selected>AISI 316L</option>
                            <option value="SMO 254">SMO 254</option>
                            <option value="Hast-C276">Hast-C276</option>
                            <option value="Titanium">Titanium</option>
                            <option value="AISI 304">AISI 304</option>
                            <option value="AISI316Ti">AISI316Ti</option>
                            <option value="904L">904L</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label title="tech_R27_materialThicknessType">R27 Frame Material</label>
                        <select id="tech_R27_materialThicknessType">
                            <option value="ст3">ст3</option>
                            <option value="ст20">ст20</option>
                            <option value="09Г2С" selected>09Г2С</option>
                            <option value="12Х18Н10Т">12Х18Н10Т</option>
                            <option value="AISI 304">AISI 304</option>
                            <option value="AISI 316L">AISI 316L</option>
                            <option value="AISI 321">AISI 321</option>
                            <option value="AISI 316Ti">AISI 316Ti</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label title="tech_S27_materialThicknessType">S27 Groove Type</label>
                        <select id="tech_S27_materialThicknessType">
                            <option value="гофра" selected>гофра</option>
                            <option value="дв. лунка">дв. лунка</option>
                            <option value="од. лунка">од. лунка</option>
                            <option value="шпилька">шпилька</option>
                            <option value="шпилька-лунка">шпилька-лунка</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label title="tech_T27_materialThicknessType">T27 Groove Depth mm</label>
                        <input type="number" id="tech_T27_materialThicknessType" value="5">
                    </div>
                    <div class="form-group">
                        <label title="tech_U27_materialThicknessType">U27 Plate Thickness</label>
                        <select id="tech_U27_materialThicknessType">
                            <option value="0.8">0.8</option>
                            <option value="1" selected>1</option>
                            <option value="1.2">1.2</option>
                            <option value="1.5">1.5</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label title="tech_V27_thicknessType">V27 Cladding mm</label>
                        <select id="tech_V27_thicknessType">
                            <option value="0.8">0.8</option>
                            <option value="1">1</option>
                            <option value="1.2">1.2</option>
                            <option value="1.5">1.5</option>
                            <option value="2">2</option>
                            <option value="3" selected>3</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- СНАБЖЕНИЕ Main Fields -->
            <div class="form-section">
                <h3>💰 Supply Main Parameters</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_F2_parameter">F2 Base Material</label>
                        <input type="text" id="sup_F2_parameter" value="0000">
                    </div>
                    <div class="form-group">
                        <label title="sup_D8_priceMaterial">D8 Price/kg</label>
                        <input type="number" id="sup_D8_priceMaterial" value="701">
                    </div>
                    <div class="form-group">
                        <label title="sup_E8_priceMaterial">E8 Price/kg</label>
                        <input type="number" id="sup_E8_priceMaterial" value="702">
                    </div>
                    <div class="form-group">
                        <label title="sup_D9_priceMaterial">D9 Material</label>
                        <select id="sup_D9_priceMaterial">
                            <option value="ст3">ст3</option>
                            <option value="ст20">ст20</option>
                            <option value="09Г2С" selected>09Г2С</option>
                            <option value="12Х18Н10Т">12Х18Н10Т</option>
                            <option value="AISI 304">AISI 304</option>
                            <option value="AISI 316L">AISI 316L</option>
                            <option value="AISI 321">AISI 321</option>
                            <option value="AISI 316Ti">AISI 316Ti</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label title="sup_D10_priceCostMaterial">D10 Cost</label>
                        <input type="number" id="sup_D10_priceCostMaterial" value="1010">
                    </div>
                    <div class="form-group">
                        <label title="sup_D11_priceCostMaterial">D11 Cost</label>
                        <input type="number" id="sup_D11_priceCostMaterial" value="1011">
                    </div>
                    <div class="form-group">
                        <label title="sup_K13_costQuantityNormTotal">K13 Norm Cost</label>
                        <input type="number" id="sup_K13_costQuantityNormTotal" value="1">
                    </div>
                    <div class="form-group">
                        <label title="sup_P13_costQuantityMaterialNorm">P13 Material Norm</label>
                        <input type="number" id="sup_P13_costQuantityMaterialNorm" value="120013">
                    </div>
                    <div class="form-group">
                        <label title="sup_D17_priceWeightThickness">D17 Weight</label>
                        <input type="number" id="sup_D17_priceWeightThickness" value="1017">
                    </div>
                    <div class="form-group">
                        <label title="sup_D78_massThickness">D78 Mass mm</label>
                        <input type="number" id="sup_D78_massThickness" value="3">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ E Column -->
            <div class="form-section">
                <h3>📦 Supply E Column</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_E19_priceWeightThicknessTotal">E19 Weight Total</label>
                        <input type="number" id="sup_E19_priceWeightThicknessTotal" value="1019">
                    </div>
                    <div class="form-group">
                        <label title="sup_E20_priceWeightThicknessTotal">E20 Weight Total</label>
                        <input type="number" id="sup_E20_priceWeightThicknessTotal" value="1020">
                    </div>
                    <div class="form-group">
                        <label title="sup_E21_priceWeightThicknessTotal">E21 Weight Total</label>
                        <input type="number" id="sup_E21_priceWeightThicknessTotal" value="1021">
                    </div>
                    <div class="form-group">
                        <label title="sup_E25_priceWeightThicknessTotal">E25 Weight Total</label>
                        <input type="number" id="sup_E25_priceWeightThicknessTotal" value="1025">
                    </div>
                    <div class="form-group">
                        <label title="sup_E26_priceWeightThickness">E26 Weight</label>
                        <input type="number" id="sup_E26_priceWeightThickness" value="1026">
                    </div>
                    <div class="form-group">
                        <label title="sup_E27_priceWeightThickness">E27 Weight</label>
                        <input type="number" id="sup_E27_priceWeightThickness" value="1027">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ Flange Fields C/D28-29 -->
            <div class="form-section">
                <h3>🔩 Flange Parameters</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_C28_priceWeightThickness">C28 Pressure</label>
                        <select id="sup_C28_priceWeightThickness">
                            <option value="Ру6">Ру6</option>
                            <option value="Ру10" selected>Ру10</option>
                            <option value="Ру16">Ру16</option>
                            <option value="Ру25">Ру25</option>
                            <option value="Ру40">Ру40</option>
                            <option value="Ру63">Ру63</option>
                            <option value="Ру100">Ру100</option>
                            <option value="Ру160">Ру160</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label title="sup_C29_priceWeightPipeThickness">C29 Pressure</label>
                        <select id="sup_C29_priceWeightPipeThickness">
                            <option value="Ру6">Ру6</option>
                            <option value="Ру10">Ру10</option>
                            <option value="Ру16">Ру16</option>
                            <option value="Ру25">Ру25</option>
                            <option value="Ру40" selected>Ру40</option>
                            <option value="Ру63">Ру63</option>
                            <option value="Ру100">Ру100</option>
                            <option value="Ру160">Ру160</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label title="sup_D28_priceWeightThickness">D28 Diameter</label>
                        <select id="sup_D28_priceWeightThickness">
                            <option value="Ду25">Ду25</option>
                            <option value="Ду32">Ду32</option>
                            <option value="Ду40">Ду40</option>
                            <option value="Ду50">Ду50</option>
                            <option value="Ду65">Ду65</option>
                            <option value="Ду80">Ду80</option>
                            <option value="Ду100">Ду100</option>
                            <option value="Ду125">Ду125</option>
                            <option value="Ду150">Ду150</option>
                            <option value="Ду200">Ду200</option>
                            <option value="Ду250">Ду250</option>
                            <option value="Ду300">Ду300</option>
                            <option value="Ду350">Ду350</option>
                            <option value="Ду400">Ду400</option>
                            <option value="Ду450">Ду450</option>
                            <option value="Ду500">Ду500</option>
                            <option value="Ду600" selected>Ду600</option>
                            <option value="Ду800">Ду800</option>
                            <option value="Ду1000">Ду1000</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label title="sup_D29_priceWeightPipe">D29 Diameter</label>
                        <select id="sup_D29_priceWeightPipe">
                            <option value="Ду25">Ду25</option>
                            <option value="Ду32">Ду32</option>
                            <option value="Ду40">Ду40</option>
                            <option value="Ду50">Ду50</option>
                            <option value="Ду65">Ду65</option>
                            <option value="Ду80">Ду80</option>
                            <option value="Ду100">Ду100</option>
                            <option value="Ду125">Ду125</option>
                            <option value="Ду150">Ду150</option>
                            <option value="Ду200">Ду200</option>
                            <option value="Ду250">Ду250</option>
                            <option value="Ду300">Ду300</option>
                            <option value="Ду350">Ду350</option>
                            <option value="Ду400">Ду400</option>
                            <option value="Ду450">Ду450</option>
                            <option value="Ду500">Ду500</option>
                            <option value="Ду600" selected>Ду600</option>
                            <option value="Ду800">Ду800</option>
                            <option value="Ду1000">Ду1000</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ F Column -->
            <div class="form-section">
                <h3>📊 Supply F Column</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_F28_priceWeightThicknessTotal">F28 Total</label>
                        <input type="number" id="sup_F28_priceWeightThicknessTotal" value="1028">
                    </div>
                    <div class="form-group">
                        <label title="sup_F29_priceWeightPipeTotal">F29 Pipe Total</label>
                        <input type="number" id="sup_F29_priceWeightPipeTotal" value="1029">
                    </div>
                    <div class="form-group">
                        <label title="sup_F30_priceWeightPipeTotal">F30 Pipe Total</label>
                        <input type="number" id="sup_F30_priceWeightPipeTotal" value="1030">
                    </div>
                    <div class="form-group">
                        <label title="sup_F31_priceWeightPipeTotal">F31 Pipe Total</label>
                        <input type="number" id="sup_F31_priceWeightPipeTotal" value="1031">
                    </div>
                    <div class="form-group">
                        <label title="sup_F32_priceWeightPipeTotal">F32 Pipe Total</label>
                        <input type="number" id="sup_F32_priceWeightPipeTotal" value="1032">
                    </div>
                    <div class="form-group">
                        <label title="sup_F33_priceWeightPipeTotal">F33 Pipe Total</label>
                        <input type="number" id="sup_F33_priceWeightPipeTotal" value="1033">
                    </div>
                    <div class="form-group">
                        <label title="sup_F39_priceQuantityWeightMaterialInsulationTotal">F39 Insulation</label>
                        <input type="number" id="sup_F39_priceQuantityWeightMaterialInsulationTotal" value="2">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ D38-46 Price Fields -->
            <div class="form-section">
                <h3>💵 Price Components D</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_D38_priceQuantityTotal">D38 Quantity Total</label>
                        <input type="number" id="sup_D38_priceQuantityTotal" value="1038">
                    </div>
                    <div class="form-group">
                        <label title="sup_D43_priceTotal">D43 Price Total</label>
                        <input type="number" id="sup_D43_priceTotal" value="3301">
                    </div>
                    <div class="form-group">
                        <label title="sup_D44_price">D44 Price</label>
                        <input type="number" id="sup_D44_price" value="1751">
                    </div>
                    <div class="form-group">
                        <label title="sup_D45_price">D45 Price</label>
                        <input type="number" id="sup_D45_price" value="2801">
                    </div>
                    <div class="form-group">
                        <label title="sup_D46_price">D46 Price</label>
                        <input type="number" id="sup_D46_price" value="1201">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ G/H Price Fields -->
            <div class="form-section">
                <h3>💸 Price Components G/H</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_G43_priceMaterialInsulationTotal">G43 Insulation</label>
                        <input type="number" id="sup_G43_priceMaterialInsulationTotal" value="2043">
                    </div>
                    <div class="form-group">
                        <label title="sup_G44_priceMaterialInsulation">G44 Insulation</label>
                        <input type="number" id="sup_G44_priceMaterialInsulation" value="2044">
                    </div>
                    <div class="form-group">
                        <label title="sup_G45_priceMaterialInsulation">G45 Insulation</label>
                        <input type="number" id="sup_G45_priceMaterialInsulation" value="2045">
                    </div>
                    <div class="form-group">
                        <label title="sup_H54_priceTotal">H54 Total</label>
                        <input type="number" id="sup_H54_priceTotal" value="2054">
                    </div>
                    <div class="form-group">
                        <label title="sup_H55_priceTotal">H55 Total</label>
                        <input type="number" id="sup_H55_priceTotal" value="2055">
                    </div>
                    <div class="form-group">
                        <label title="sup_H56_priceTotal">H56 Total</label>
                        <input type="number" id="sup_H56_priceTotal" value="2056">
                    </div>
                    <div class="form-group">
                        <label title="sup_H57_priceTotal">H57 Total</label>
                        <input type="number" id="sup_H57_priceTotal" value="2057">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ I Column -->
            <div class="form-section">
                <h3>📈 Supply I Column</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_I28_priceWeightThicknessType">I28 Weight Type</label>
                        <input type="number" id="sup_I28_priceWeightThicknessType" value="2028">
                    </div>
                    <div class="form-group">
                        <label title="sup_I29_priceWeightPipeThicknessType">I29 Pipe Type</label>
                        <input type="number" id="sup_I29_priceWeightPipeThicknessType" value="2029">
                    </div>
                    <div class="form-group">
                        <label title="sup_I38_priceThicknessTotalType">I38 Thickness</label>
                        <input type="number" id="sup_I38_priceThicknessTotalType" value="2038">
                    </div>
                    <div class="form-group">
                        <label title="sup_I39_priceQuantityMaterialThicknessInsulationTotalType">I39 Material</label>
                        <input type="number" id="sup_I39_priceQuantityMaterialThicknessInsulationTotalType" value="2039">
                    </div>
                    <div class="form-group">
                        <label title="sup_I44_priceMaterialThicknessInsulationTotalType">I44 Material</label>
                        <input type="number" id="sup_I44_priceMaterialThicknessInsulationTotalType" value="2044">
                    </div>
                    <div class="form-group">
                        <label title="sup_I45_priceMaterialThicknessInsulationTotalType">I45 Material</label>
                        <input type="number" id="sup_I45_priceMaterialThicknessInsulationTotalType" value="2045">
                    </div>
                    <div class="form-group">
                        <label title="sup_I46_priceQuantityMaterialThicknessInsulationTotalSumType">I46 Sum</label>
                        <input type="number" id="sup_I46_priceQuantityMaterialThicknessInsulationTotalSumType" value="2046">
                    </div>
                    <div class="form-group">
                        <label title="sup_I50_priceQuantityMaterialThicknessInsulationTotalSumType">I50 Sum</label>
                        <input type="number" id="sup_I50_priceQuantityMaterialThicknessInsulationTotalSumType" value="2050">
                    </div>
                    <div class="form-group">
                        <label title="sup_I51_priceQuantityMaterialThicknessInsulationTotalSumType">I51 Sum</label>
                        <input type="number" id="sup_I51_priceQuantityMaterialThicknessInsulationTotalSumType" value="2051">
                    </div>
                    <div class="form-group">
                        <label title="sup_I52_priceQuantityMaterialThicknessInsulationTotalSumType">I52 Sum</label>
                        <input type="number" id="sup_I52_priceQuantityMaterialThicknessInsulationTotalSumType" value="2052">
                    </div>
                    <div class="form-group">
                        <label title="sup_I54_priceQuantityMaterialThicknessInsulationTotalType">I54 Type</label>
                        <input type="number" id="sup_I54_priceQuantityMaterialThicknessInsulationTotalType" value="2054">
                    </div>
                    <div class="form-group">
                        <label title="sup_I55_priceQuantityMaterialThicknessInsulationTotalType">I55 Type</label>
                        <input type="number" id="sup_I55_priceQuantityMaterialThicknessInsulationTotalType" value="2055">
                    </div>
                    <div class="form-group">
                        <label title="sup_I56_priceQuantityMaterialThicknessInsulationTotalType">I56 Type</label>
                        <input type="number" id="sup_I56_priceQuantityMaterialThicknessInsulationTotalType" value="2056">
                    </div>
                    <div class="form-group">
                        <label title="sup_I57_priceQuantityMaterialThicknessInsulationTotalType">I57 Type</label>
                        <input type="number" id="sup_I57_priceQuantityMaterialThicknessInsulationTotalType" value="2057">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ J/K Columns -->
            <div class="form-section">
                <h3>📉 Supply J/K Columns</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_J28_priceQuantityWeightThicknessNormTotal">J28 Norm Total</label>
                        <input type="number" id="sup_J28_priceQuantityWeightThicknessNormTotal" value="3028">
                    </div>
                    <div class="form-group">
                        <label title="sup_J29_priceQuantityWeightPipeNormTotal">J29 Pipe Norm</label>
                        <input type="number" id="sup_J29_priceQuantityWeightPipeNormTotal" value="3029">
                    </div>
                    <div class="form-group">
                        <label title="sup_K19_priceWeightThicknessTotal">K19 Weight Total</label>
                        <input type="number" id="sup_K19_priceWeightThicknessTotal" value="3019">
                    </div>
                    <div class="form-group">
                        <label title="sup_K20_priceWeightThicknessTotal">K20 Weight Total</label>
                        <input type="number" id="sup_K20_priceWeightThicknessTotal" value="3020">
                    </div>
                    <div class="form-group">
                        <label title="sup_K21_priceWeightThicknessTotal">K21 Weight Total</label>
                        <input type="number" id="sup_K21_priceWeightThicknessTotal" value="3021">
                    </div>
                    <div class="form-group">
                        <label title="sup_K25_priceWeightThicknessTotal">K25 Weight Total</label>
                        <input type="number" id="sup_K25_priceWeightThicknessTotal" value="3025">
                    </div>
                    <div class="form-group">
                        <label title="sup_K26_priceWeightThickness">K26 Weight</label>
                        <input type="number" id="sup_K26_priceWeightThickness" value="3026">
                    </div>
                    <div class="form-group">
                        <label title="sup_K27_priceWeightThickness">K27 Weight</label>
                        <input type="number" id="sup_K27_priceWeightThickness" value="3027">
                    </div>
                    <div class="form-group">
                        <label title="sup_K38_pricePipeTotal">K38 Pipe Total</label>
                        <input type="number" id="sup_K38_pricePipeTotal" value="3038">
                    </div>
                    <div class="form-group">
                        <label title="sup_K39_priceQuantityMaterialPipeInsulationTotal">K39 Insulation</label>
                        <input type="number" id="sup_K39_priceQuantityMaterialPipeInsulationTotal" value="3039">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ L Column -->
            <div class="form-section">
                <h3>📦 Supply L Column</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_L28_priceWeightThicknessTotalType">L28 Type</label>
                        <input type="number" id="sup_L28_priceWeightThicknessTotalType" value="4028">
                    </div>
                    <div class="form-group">
                        <label title="sup_L29_priceWeightPipeTotalType">L29 Pipe Type</label>
                        <input type="number" id="sup_L29_priceWeightPipeTotalType" value="4029">
                    </div>
                    <div class="form-group">
                        <label title="sup_L30_priceWeightPipeTotalType">L30 Pipe Type</label>
                        <input type="number" id="sup_L30_priceWeightPipeTotalType" value="4030">
                    </div>
                    <div class="form-group">
                        <label title="sup_L31_priceWeightPipeTotalType">L31 Pipe Type</label>
                        <input type="number" id="sup_L31_priceWeightPipeTotalType" value="4031">
                    </div>
                    <div class="form-group">
                        <label title="sup_L32_priceWeightPipeTotalType">L32 Pipe Type</label>
                        <input type="number" id="sup_L32_priceWeightPipeTotalType" value="4032">
                    </div>
                    <div class="form-group">
                        <label title="sup_L33_priceWeightPipeTotalType">L33 Pipe Type</label>
                        <input type="number" id="sup_L33_priceWeightPipeTotalType" value="4033">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ M Column -->
            <div class="form-section">
                <h3>💰 Supply M Column</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_M38_priceMaterialTotal">M38 Material Total</label>
                        <input type="number" id="sup_M38_priceMaterialTotal" value="5038">
                    </div>
                    <div class="form-group">
                        <label title="sup_M39_quantityMaterialTotal">M39 Quantity</label>
                        <input type="number" id="sup_M39_quantityMaterialTotal" value="5039">
                    </div>
                    <div class="form-group">
                        <label title="sup_M44_priceMaterial">M44 Material</label>
                        <input type="number" id="sup_M44_priceMaterial" value="5044">
                    </div>
                    <div class="form-group">
                        <label title="sup_M45_priceMaterial">M45 Material</label>
                        <input type="number" id="sup_M45_priceMaterial" value="5045">
                    </div>
                    <div class="form-group">
                        <label title="sup_M46_priceQuantityMaterialSum">M46 Sum</label>
                        <input type="number" id="sup_M46_priceQuantityMaterialSum" value="5046">
                    </div>
                    <div class="form-group">
                        <label title="sup_M51_priceQuantityMaterialTotalSum">M51 Total Sum</label>
                        <input type="number" id="sup_M51_priceQuantityMaterialTotalSum" value="5051">
                    </div>
                    <div class="form-group">
                        <label title="sup_M52_priceQuantityMaterialTotalSum">M52 Total Sum</label>
                        <input type="number" id="sup_M52_priceQuantityMaterialTotalSum" value="5052">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ N Column -->
            <div class="form-section">
                <h3>📊 Supply N Column</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_N50_priceQuantityWeightThicknessTotalSum">N50 Sum</label>
                        <input type="number" id="sup_N50_priceQuantityWeightThicknessTotalSum" value="6050">
                    </div>
                    <div class="form-group">
                        <label title="sup_N51_priceQuantityWeightThicknessTotalSum">N51 Sum</label>
                        <input type="number" id="sup_N51_priceQuantityWeightThicknessTotalSum" value="6051">
                    </div>
                    <div class="form-group">
                        <label title="sup_N52_priceQuantityWeightThicknessTotalSum">N52 Sum</label>
                        <input type="number" id="sup_N52_priceQuantityWeightThicknessTotalSum" value="6052">
                    </div>
                    <div class="form-group">
                        <label title="sup_N54_quantityWeightThicknessTotal">N54 Total</label>
                        <input type="number" id="sup_N54_quantityWeightThicknessTotal" value="6054">
                    </div>
                    <div class="form-group">
                        <label title="sup_N55_quantityWeightThicknessTotal">N55 Total</label>
                        <input type="number" id="sup_N55_quantityWeightThicknessTotal" value="6055">
                    </div>
                    <div class="form-group">
                        <label title="sup_N56_quantityWeightThicknessTotal">N56 Total</label>
                        <input type="number" id="sup_N56_quantityWeightThicknessTotal" value="6056">
                    </div>
                    <div class="form-group">
                        <label title="sup_N57_quantityWeightThicknessTotal">N57 Total</label>
                        <input type="number" id="sup_N57_quantityWeightThicknessTotal" value="6057">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ P Column -->
            <div class="form-section">
                <h3>💵 Supply P Column</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_P19_priceQuantityMaterialThickness">P19 Thickness</label>
                        <input type="number" id="sup_P19_priceQuantityMaterialThickness" value="7019">
                    </div>
                    <div class="form-group">
                        <label title="sup_P20_priceQuantityWeightMaterial">P20 Weight</label>
                        <input type="number" id="sup_P20_priceQuantityWeightMaterial" value="7020">
                    </div>
                    <div class="form-group">
                        <label title="sup_P21_priceQuantityMaterial">P21 Material</label>
                        <input type="number" id="sup_P21_priceQuantityMaterial" value="7021">
                    </div>
                    <div class="form-group">
                        <label title="sup_P22_priceQuantityMaterialTotal">P22 Total</label>
                        <input type="number" id="sup_P22_priceQuantityMaterialTotal" value="7022">
                    </div>
                    <div class="form-group">
                        <label title="sup_P29_priceMaterialTotal">P29 Material</label>
                        <input type="number" id="sup_P29_priceMaterialTotal" value="7029">
                    </div>
                    <div class="form-group">
                        <label title="sup_P33_priceMaterialPipeTotal">P33 Pipe</label>
                        <input type="number" id="sup_P33_priceMaterialPipeTotal" value="7033">
                    </div>
                    <div class="form-group">
                        <label title="sup_P37_priceMaterialTotal">P37 Material</label>
                        <input type="number" id="sup_P37_priceMaterialTotal" value="7037">
                    </div>
                    <div class="form-group">
                        <label title="sup_P41_priceMaterialTotal">P41 Material</label>
                        <input type="number" id="sup_P41_priceMaterialTotal" value="7041">
                    </div>
                    <div class="form-group">
                        <label title="sup_P45_priceMaterialTotal">P45 Material</label>
                        <input type="number" id="sup_P45_priceMaterialTotal" value="7045">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ Q Column -->
            <div class="form-section">
                <h3>📈 Supply Q Column</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_Q22_priceQuantityMaterialThicknessTotal">Q22 Total</label>
                        <input type="number" id="sup_Q22_priceQuantityMaterialThicknessTotal" value="8022">
                    </div>
                    <div class="form-group">
                        <label title="sup_Q23_priceMaterialThicknessTotal">Q23 Total</label>
                        <input type="number" id="sup_Q23_priceMaterialThicknessTotal" value="8023">
                    </div>
                    <div class="form-group">
                        <label title="sup_Q24_priceThicknessTotal">Q24 Total</label>
                        <input type="number" id="sup_Q24_priceThicknessTotal" value="8024">
                    </div>
                    <div class="form-group">
                        <label title="sup_Q29_priceThickness">Q29 Thickness</label>
                        <input type="number" id="sup_Q29_priceThickness" value="8029">
                    </div>
                    <div class="form-group">
                        <label title="sup_Q33_pricePipeThickness">Q33 Pipe</label>
                        <input type="number" id="sup_Q33_pricePipeThickness" value="8033">
                    </div>
                    <div class="form-group">
                        <label title="sup_Q37_priceThickness">Q37 Thickness</label>
                        <input type="number" id="sup_Q37_priceThickness" value="8037">
                    </div>
                    <div class="form-group">
                        <label title="sup_Q41_priceThicknessTotal">Q41 Total</label>
                        <input type="number" id="sup_Q41_priceThicknessTotal" value="8041">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ R Column -->
            <div class="form-section">
                <h3>💸 Supply R Column</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_R29_price">R29 Price</label>
                        <input type="number" id="sup_R29_price" value="9029">
                    </div>
                    <div class="form-group">
                        <label title="sup_R33_pricePipe">R33 Pipe</label>
                        <input type="number" id="sup_R33_pricePipe" value="9033">
                    </div>
                    <div class="form-group">
                        <label title="sup_R37_price">R37 Price</label>
                        <input type="number" id="sup_R37_price" value="9037">
                    </div>
                    <div class="form-group">
                        <label title="sup_R41_priceTotal">R41 Total</label>
                        <input type="number" id="sup_R41_priceTotal" value="9041">
                    </div>
                </div>
            </div>

            <!-- СНАБЖЕНИЕ T Column -->
            <div class="form-section">
                <h3>💰 Supply T Column</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label title="sup_T29_priceMaterial">T29 Material</label>
                        <input type="number" id="sup_T29_priceMaterial" value="10029">
                    </div>
                    <div class="form-group">
                        <label title="sup_T30_priceMaterial">T30 Material</label>
                        <input type="number" id="sup_T30_priceMaterial" value="10030">
                    </div>
                    <div class="form-group">
                        <label title="sup_T31_priceMaterial">T31 Material</label>
                        <input type="number" id="sup_T31_priceMaterial" value="10031">
                    </div>
                    <div class="form-group">
                        <label title="sup_T33_priceMaterialPipe">T33 Pipe</label>
                        <input type="number" id="sup_T33_priceMaterialPipe" value="10033">
                    </div>
                    <div class="form-group">
                        <label title="sup_T34_priceMaterialTotal">T34 Total</label>
                        <input type="number" id="sup_T34_priceMaterialTotal" value="10034">
                    </div>
                    <div class="form-group">
                        <label title="sup_T35_priceMaterialTotal">T35 Total</label>
                        <input type="number" id="sup_T35_priceMaterialTotal" value="10035">
                    </div>
                    <div class="form-group">
                        <label title="sup_T37_price">T37 Price</label>
                        <input type="number" id="sup_T37_price" value="10037">
                    </div>
                    <div class="form-group">
                        <label title="sup_T38_price">T38 Price</label>
                        <input type="number" id="sup_T38_price" value="10038">
                    </div>
                    <div class="form-group">
                        <label title="sup_T39_priceQuantity">T39 Quantity</label>
                        <input type="number" id="sup_T39_priceQuantity" value="10039">
                    </div>
                    <div class="form-group">
                        <label title="sup_T41_priceTotal">T41 Total</label>
                        <input type="number" id="sup_T41_priceTotal" value="10041">
                    </div>
                    <div class="form-group">
                        <label title="sup_T42_priceMaterialInsulationTotal">T42 Insulation</label>
                        <input type="number" id="sup_T42_priceMaterialInsulationTotal" value="10042">
                    </div>
                    <div class="form-group">
                        <label title="sup_T43_priceTotal">T43 Total</label>
                        <input type="number" id="sup_T43_priceTotal" value="10043">
                    </div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="calculateCost()">🧮 Calculate Cost</button>
                <button class="btn-secondary" onclick="fillRealisticValues()">📝 Load Example Values</button>
                <button class="btn-secondary" onclick="clearForm()">🗑️ Clear Form</button>
            </div>
            
            <div class="loading" id="loading">
                <p>Processing calculation with LibreOffice...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            
            <div id="responseArea" class="response-area">Click "Calculate Cost" to see results here...</div>
            
            <div class="download-section" id="downloadSection">
                <div style="display: flex; align-items: center; justify-content: space-between; gap: 16px;">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: #2d3748; margin-bottom: 4px;">Excel File Ready!</div>
                        <div style="font-size: 12px; color: #718096;">Your calculation has been saved</div>
                    </div>
                    <a id="downloadLink" href="#" class="download-btn" download>
                        📥 Download Excel
                    </a>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>📂 Generated Excel Files</h2>
            <div id="fileList" class="file-list">
                <div style="padding: 20px; text-align: center; color: #718096;">
                    Loading files...
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Initialize dashboard
        let updateInterval;
        
        async function updateMetrics() {
            try {
                // Update health status
                const healthResponse = await fetch('/health');
                const healthData = await healthResponse.json();
                
                document.getElementById('healthStatus').className = 'status-indicator status-healthy';
                document.getElementById('healthMetrics').innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Status</span>
                        <span class="metric-value">${healthData.status}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Version</span>
                        <span class="metric-value">${healthData.version}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Uptime</span>
                        <span class="metric-value">${formatUptime(healthData.uptime)}</span>
                    </div>
                `;
                
                // Update system metrics
                const metricsResponse = await fetch('/api/metrics');
                const metricsData = await metricsResponse.json();
                
                document.getElementById('systemMetrics').innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Active Workers</span>
                        <span class="metric-value">${metricsData.queue.activeWorkers}/${metricsData.queue.totalWorkers}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Queue Size</span>
                        <span class="metric-value">${metricsData.queue.queuedRequests}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Avg Response</span>
                        <span class="metric-value">${metricsData.requests.averageResponseTime}ms</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Success Rate</span>
                        <span class="metric-value">${metricsData.requests.successRate}%</span>
                    </div>
                `;
                
                // Update file count
                const filesResponse = await fetch('/api/excel-files');
                const filesData = await filesResponse.json();
                
                document.getElementById('recentFiles').innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Total Files</span>
                        <span class="metric-value">${filesData.count}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Latest</span>
                        <span class="metric-value">${filesData.count > 0 ? new Date(filesData.files[0].created).toLocaleTimeString() : 'None'}</span>
                    </div>
                `;
                
                updateFileList(filesData.files);
                
            } catch (error) {
                console.error('Failed to update metrics:', error);
            }
        }
        
        function formatUptime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else if (minutes > 0) {
                return `${minutes}m ${secs}s`;
            } else {
                return `${secs}s`;
            }
        }
        
        async function calculateCost() {
            const loading = document.getElementById('loading');
            const errorMessage = document.getElementById('errorMessage');
            const responseArea = document.getElementById('responseArea');
            const downloadSection = document.getElementById('downloadSection');
            const progressFill = document.getElementById('progressFill');
            
            loading.classList.add('active');
            errorMessage.classList.remove('active');
            downloadSection.classList.remove('active');
            progressFill.style.width = '0%';
            
            // Animate progress bar
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 5;
                if (progress <= 90) {
                    progressFill.style.width = progress + '%';
                }
            }, 200);
            
            try {
                const requestData = {
                    // Technical fields (16 fields)
                    tech_D27_type: parseInt(document.getElementById('tech_D27_type').value) || null,
                    tech_E27_weightType: document.getElementById('tech_E27_weightType').value,
                    tech_F27_quantityType: document.getElementById('tech_F27_quantityType').value,
                    tech_G27_quantityType: document.getElementById('tech_G27_quantityType').value,
                    tech_H27_quantityType: document.getElementById('tech_H27_quantityType').value,
                    tech_I27_quantityType: parseInt(document.getElementById('tech_I27_quantityType').value) || null,
                    tech_J27_quantityType: parseInt(document.getElementById('tech_J27_quantityType').value) || null,
                    tech_K27_quantity: parseInt(document.getElementById('tech_K27_quantity').value) || null,
                    tech_L27_quantity: parseInt(document.getElementById('tech_L27_quantity').value) || null,
                    tech_M27_material: parseInt(document.getElementById('tech_M27_material').value) || null,
                    tech_P27_materialType: document.getElementById('tech_P27_materialType').value,
                    tech_R27_materialThicknessType: document.getElementById('tech_R27_materialThicknessType').value,
                    tech_S27_materialThicknessType: document.getElementById('tech_S27_materialThicknessType').value,
                    tech_T27_materialThicknessType: parseInt(document.getElementById('tech_T27_materialThicknessType').value) || null,
                    tech_U27_materialThicknessType: parseFloat(document.getElementById('tech_U27_materialThicknessType').value) || null,
                    tech_V27_thicknessType: parseFloat(document.getElementById('tech_V27_thicknessType').value) || null,
                    
                    // Supply fields (122 fields)
                    sup_F2_parameter: document.getElementById('sup_F2_parameter').value,
                    sup_D8_priceMaterial: parseInt(document.getElementById('sup_D8_priceMaterial').value) || null,
                    sup_E8_priceMaterial: parseInt(document.getElementById('sup_E8_priceMaterial').value) || null,
                    sup_D9_priceMaterial: document.getElementById('sup_D9_priceMaterial').value,
                    sup_D10_priceCostMaterial: parseInt(document.getElementById('sup_D10_priceCostMaterial').value) || null,
                    sup_D11_priceCostMaterial: parseInt(document.getElementById('sup_D11_priceCostMaterial').value) || null,
                    sup_K13_costQuantityNormTotal: parseInt(document.getElementById('sup_K13_costQuantityNormTotal').value) || null,
                    sup_P13_costQuantityMaterialNorm: parseInt(document.getElementById('sup_P13_costQuantityMaterialNorm').value) || null,
                    sup_D17_priceWeightThickness: parseInt(document.getElementById('sup_D17_priceWeightThickness').value) || null,
                    sup_D78_massThickness: parseInt(document.getElementById('sup_D78_massThickness').value) || null,
                    sup_E19_priceWeightThicknessTotal: parseInt(document.getElementById('sup_E19_priceWeightThicknessTotal').value) || null,
                    sup_E20_priceWeightThicknessTotal: parseInt(document.getElementById('sup_E20_priceWeightThicknessTotal').value) || null,
                    sup_E21_priceWeightThicknessTotal: parseInt(document.getElementById('sup_E21_priceWeightThicknessTotal').value) || null,
                    sup_E25_priceWeightThicknessTotal: parseInt(document.getElementById('sup_E25_priceWeightThicknessTotal').value) || null,
                    sup_E26_priceWeightThickness: parseInt(document.getElementById('sup_E26_priceWeightThickness').value) || null,
                    sup_E27_priceWeightThickness: parseInt(document.getElementById('sup_E27_priceWeightThickness').value) || null,
                    sup_C28_priceWeightThickness: document.getElementById('sup_C28_priceWeightThickness').value,
                    sup_C29_priceWeightPipeThickness: document.getElementById('sup_C29_priceWeightPipeThickness').value,
                    sup_D28_priceWeightThickness: document.getElementById('sup_D28_priceWeightThickness').value,
                    sup_D29_priceWeightPipe: document.getElementById('sup_D29_priceWeightPipe').value,
                    sup_F28_priceWeightThicknessTotal: parseInt(document.getElementById('sup_F28_priceWeightThicknessTotal').value) || null,
                    sup_F29_priceWeightPipeTotal: parseInt(document.getElementById('sup_F29_priceWeightPipeTotal').value) || null,
                    sup_F30_priceWeightPipeTotal: parseInt(document.getElementById('sup_F30_priceWeightPipeTotal').value) || null,
                    sup_F31_priceWeightPipeTotal: parseInt(document.getElementById('sup_F31_priceWeightPipeTotal').value) || null,
                    sup_F32_priceWeightPipeTotal: parseInt(document.getElementById('sup_F32_priceWeightPipeTotal').value) || null,
                    sup_F33_priceWeightPipeTotal: parseInt(document.getElementById('sup_F33_priceWeightPipeTotal').value) || null,
                    sup_F39_priceQuantityWeightMaterialInsulationTotal: parseInt(document.getElementById('sup_F39_priceQuantityWeightMaterialInsulationTotal').value) || null,
                    sup_D38_priceQuantityTotal: parseInt(document.getElementById('sup_D38_priceQuantityTotal').value) || null,
                    sup_D43_priceTotal: parseInt(document.getElementById('sup_D43_priceTotal').value) || null,
                    sup_D44_price: parseInt(document.getElementById('sup_D44_price').value) || null,
                    sup_D45_price: parseInt(document.getElementById('sup_D45_price').value) || null,
                    sup_D46_price: parseInt(document.getElementById('sup_D46_price').value) || null,
                    sup_G43_priceMaterialInsulationTotal: parseInt(document.getElementById('sup_G43_priceMaterialInsulationTotal').value) || null,
                    sup_G44_priceMaterialInsulation: parseInt(document.getElementById('sup_G44_priceMaterialInsulation').value) || null,
                    sup_G45_priceMaterialInsulation: parseInt(document.getElementById('sup_G45_priceMaterialInsulation').value) || null,
                    sup_H54_priceTotal: parseInt(document.getElementById('sup_H54_priceTotal').value) || null,
                    sup_H55_priceTotal: parseInt(document.getElementById('sup_H55_priceTotal').value) || null,
                    sup_H56_priceTotal: parseInt(document.getElementById('sup_H56_priceTotal').value) || null,
                    sup_H57_priceTotal: parseInt(document.getElementById('sup_H57_priceTotal').value) || null,
                    sup_I28_priceWeightThicknessType: parseInt(document.getElementById('sup_I28_priceWeightThicknessType').value) || null,
                    sup_I29_priceWeightPipeThicknessType: parseInt(document.getElementById('sup_I29_priceWeightPipeThicknessType').value) || null,
                    sup_I38_priceThicknessTotalType: parseInt(document.getElementById('sup_I38_priceThicknessTotalType').value) || null,
                    sup_I39_priceQuantityMaterialThicknessInsulationTotalType: parseInt(document.getElementById('sup_I39_priceQuantityMaterialThicknessInsulationTotalType').value) || null,
                    sup_I44_priceMaterialThicknessInsulationTotalType: parseInt(document.getElementById('sup_I44_priceMaterialThicknessInsulationTotalType').value) || null,
                    sup_I45_priceMaterialThicknessInsulationTotalType: parseInt(document.getElementById('sup_I45_priceMaterialThicknessInsulationTotalType').value) || null,
                    sup_I46_priceQuantityMaterialThicknessInsulationTotalSumType: parseInt(document.getElementById('sup_I46_priceQuantityMaterialThicknessInsulationTotalSumType').value) || null,
                    sup_I50_priceQuantityMaterialThicknessInsulationTotalSumType: parseInt(document.getElementById('sup_I50_priceQuantityMaterialThicknessInsulationTotalSumType').value) || null,
                    sup_I51_priceQuantityMaterialThicknessInsulationTotalSumType: parseInt(document.getElementById('sup_I51_priceQuantityMaterialThicknessInsulationTotalSumType').value) || null,
                    sup_I52_priceQuantityMaterialThicknessInsulationTotalSumType: parseInt(document.getElementById('sup_I52_priceQuantityMaterialThicknessInsulationTotalSumType').value) || null,
                    sup_I54_priceQuantityMaterialThicknessInsulationTotalType: parseInt(document.getElementById('sup_I54_priceQuantityMaterialThicknessInsulationTotalType').value) || null,
                    sup_I55_priceQuantityMaterialThicknessInsulationTotalType: parseInt(document.getElementById('sup_I55_priceQuantityMaterialThicknessInsulationTotalType').value) || null,
                    sup_I56_priceQuantityMaterialThicknessInsulationTotalType: parseInt(document.getElementById('sup_I56_priceQuantityMaterialThicknessInsulationTotalType').value) || null,
                    sup_I57_priceQuantityMaterialThicknessInsulationTotalType: parseInt(document.getElementById('sup_I57_priceQuantityMaterialThicknessInsulationTotalType').value) || null,
                    sup_J28_priceQuantityWeightThicknessNormTotal: parseInt(document.getElementById('sup_J28_priceQuantityWeightThicknessNormTotal').value) || null,
                    sup_J29_priceQuantityWeightPipeNormTotal: parseInt(document.getElementById('sup_J29_priceQuantityWeightPipeNormTotal').value) || null,
                    sup_K19_priceWeightThicknessTotal: parseInt(document.getElementById('sup_K19_priceWeightThicknessTotal').value) || null,
                    sup_K20_priceWeightThicknessTotal: parseInt(document.getElementById('sup_K20_priceWeightThicknessTotal').value) || null,
                    sup_K21_priceWeightThicknessTotal: parseInt(document.getElementById('sup_K21_priceWeightThicknessTotal').value) || null,
                    sup_K25_priceWeightThicknessTotal: parseInt(document.getElementById('sup_K25_priceWeightThicknessTotal').value) || null,
                    sup_K26_priceWeightThickness: parseInt(document.getElementById('sup_K26_priceWeightThickness').value) || null,
                    sup_K27_priceWeightThickness: parseInt(document.getElementById('sup_K27_priceWeightThickness').value) || null,
                    sup_K38_pricePipeTotal: parseInt(document.getElementById('sup_K38_pricePipeTotal').value) || null,
                    sup_K39_priceQuantityMaterialPipeInsulationTotal: parseInt(document.getElementById('sup_K39_priceQuantityMaterialPipeInsulationTotal').value) || null,
                    sup_L28_priceWeightThicknessTotalType: parseInt(document.getElementById('sup_L28_priceWeightThicknessTotalType').value) || null,
                    sup_L29_priceWeightPipeTotalType: parseInt(document.getElementById('sup_L29_priceWeightPipeTotalType').value) || null,
                    sup_L30_priceWeightPipeTotalType: parseInt(document.getElementById('sup_L30_priceWeightPipeTotalType').value) || null,
                    sup_L31_priceWeightPipeTotalType: parseInt(document.getElementById('sup_L31_priceWeightPipeTotalType').value) || null,
                    sup_L32_priceWeightPipeTotalType: parseInt(document.getElementById('sup_L32_priceWeightPipeTotalType').value) || null,
                    sup_L33_priceWeightPipeTotalType: parseInt(document.getElementById('sup_L33_priceWeightPipeTotalType').value) || null,
                    sup_M38_priceMaterialTotal: parseInt(document.getElementById('sup_M38_priceMaterialTotal').value) || null,
                    sup_M39_quantityMaterialTotal: parseInt(document.getElementById('sup_M39_quantityMaterialTotal').value) || null,
                    sup_M44_priceMaterial: parseInt(document.getElementById('sup_M44_priceMaterial').value) || null,
                    sup_M45_priceMaterial: parseInt(document.getElementById('sup_M45_priceMaterial').value) || null,
                    sup_M46_priceQuantityMaterialSum: parseInt(document.getElementById('sup_M46_priceQuantityMaterialSum').value) || null,
                    sup_M51_priceQuantityMaterialTotalSum: parseInt(document.getElementById('sup_M51_priceQuantityMaterialTotalSum').value) || null,
                    sup_M52_priceQuantityMaterialTotalSum: parseInt(document.getElementById('sup_M52_priceQuantityMaterialTotalSum').value) || null,
                    sup_N50_priceQuantityWeightThicknessTotalSum: parseInt(document.getElementById('sup_N50_priceQuantityWeightThicknessTotalSum').value) || null,
                    sup_N51_priceQuantityWeightThicknessTotalSum: parseInt(document.getElementById('sup_N51_priceQuantityWeightThicknessTotalSum').value) || null,
                    sup_N52_priceQuantityWeightThicknessTotalSum: parseInt(document.getElementById('sup_N52_priceQuantityWeightThicknessTotalSum').value) || null,
                    sup_N54_quantityWeightThicknessTotal: parseInt(document.getElementById('sup_N54_quantityWeightThicknessTotal').value) || null,
                    sup_N55_quantityWeightThicknessTotal: parseInt(document.getElementById('sup_N55_quantityWeightThicknessTotal').value) || null,
                    sup_N56_quantityWeightThicknessTotal: parseInt(document.getElementById('sup_N56_quantityWeightThicknessTotal').value) || null,
                    sup_N57_quantityWeightThicknessTotal: parseInt(document.getElementById('sup_N57_quantityWeightThicknessTotal').value) || null,
                    sup_P19_priceQuantityMaterialThickness: parseInt(document.getElementById('sup_P19_priceQuantityMaterialThickness').value) || null,
                    sup_P20_priceQuantityWeightMaterial: parseInt(document.getElementById('sup_P20_priceQuantityWeightMaterial').value) || null,
                    sup_P21_priceQuantityMaterial: parseInt(document.getElementById('sup_P21_priceQuantityMaterial').value) || null,
                    sup_P22_priceQuantityMaterialTotal: parseInt(document.getElementById('sup_P22_priceQuantityMaterialTotal').value) || null,
                    sup_P29_priceMaterialTotal: parseInt(document.getElementById('sup_P29_priceMaterialTotal').value) || null,
                    sup_P33_priceMaterialPipeTotal: parseInt(document.getElementById('sup_P33_priceMaterialPipeTotal').value) || null,
                    sup_P37_priceMaterialTotal: parseInt(document.getElementById('sup_P37_priceMaterialTotal').value) || null,
                    sup_P41_priceMaterialTotal: parseInt(document.getElementById('sup_P41_priceMaterialTotal').value) || null,
                    sup_P45_priceMaterialTotal: parseInt(document.getElementById('sup_P45_priceMaterialTotal').value) || null,
                    sup_Q22_priceQuantityMaterialThicknessTotal: parseInt(document.getElementById('sup_Q22_priceQuantityMaterialThicknessTotal').value) || null,
                    sup_Q23_priceMaterialThicknessTotal: parseInt(document.getElementById('sup_Q23_priceMaterialThicknessTotal').value) || null,
                    sup_Q24_priceThicknessTotal: parseInt(document.getElementById('sup_Q24_priceThicknessTotal').value) || null,
                    sup_Q29_priceThickness: parseInt(document.getElementById('sup_Q29_priceThickness').value) || null,
                    sup_Q33_pricePipeThickness: parseInt(document.getElementById('sup_Q33_pricePipeThickness').value) || null,
                    sup_Q37_priceThickness: parseInt(document.getElementById('sup_Q37_priceThickness').value) || null,
                    sup_Q41_priceThicknessTotal: parseInt(document.getElementById('sup_Q41_priceThicknessTotal').value) || null,
                    sup_R29_price: parseInt(document.getElementById('sup_R29_price').value) || null,
                    sup_R33_pricePipe: parseInt(document.getElementById('sup_R33_pricePipe').value) || null,
                    sup_R37_price: parseInt(document.getElementById('sup_R37_price').value) || null,
                    sup_R41_priceTotal: parseInt(document.getElementById('sup_R41_priceTotal').value) || null,
                    sup_T29_priceMaterial: parseInt(document.getElementById('sup_T29_priceMaterial').value) || null,
                    sup_T30_priceMaterial: parseInt(document.getElementById('sup_T30_priceMaterial').value) || null,
                    sup_T31_priceMaterial: parseInt(document.getElementById('sup_T31_priceMaterial').value) || null,
                    sup_T33_priceMaterialPipe: parseInt(document.getElementById('sup_T33_priceMaterialPipe').value) || null,
                    sup_T34_priceMaterialTotal: parseInt(document.getElementById('sup_T34_priceMaterialTotal').value) || null,
                    sup_T35_priceMaterialTotal: parseInt(document.getElementById('sup_T35_priceMaterialTotal').value) || null,
                    sup_T37_price: parseInt(document.getElementById('sup_T37_price').value) || null,
                    sup_T38_price: parseInt(document.getElementById('sup_T38_price').value) || null,
                    sup_T39_priceQuantity: parseInt(document.getElementById('sup_T39_priceQuantity').value) || null,
                    sup_T41_priceTotal: parseInt(document.getElementById('sup_T41_priceTotal').value) || null,
                    sup_T42_priceMaterialInsulationTotal: parseInt(document.getElementById('sup_T42_priceMaterialInsulationTotal').value) || null,
                    sup_T43_priceTotal: parseInt(document.getElementById('sup_T43_priceTotal').value) || null
                };
                
                const response = await fetch('/api/calculate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                clearInterval(progressInterval);
                progressFill.style.width = '100%';
                
                setTimeout(() => {
                    loading.classList.remove('active');
                    
                    if (data.success) {
                        let responseText = `✅ CALCULATION SUCCESSFUL\n\n`;
                        responseText += `Total Cost: ${data.results.total_cost.toLocaleString('ru-RU', { style: 'currency', currency: 'RUB' })}\n\n`;
                        responseText += `Component Breakdown:\n`;
                        responseText += `  • Materials: ${data.results.component_costs.materials.toLocaleString('ru-RU', { style: 'currency', currency: 'RUB' })}\n`;
                        responseText += `  • Processing: ${data.results.component_costs.processing.toLocaleString('ru-RU', { style: 'currency', currency: 'RUB' })}\n`;
                        responseText += `  • Hardware: ${data.results.component_costs.hardware.toLocaleString('ru-RU', { style: 'currency', currency: 'RUB' })}\n`;
                        responseText += `  • Other: ${data.results.component_costs.other.toLocaleString('ru-RU', { style: 'currency', currency: 'RUB' })}\n\n`;
                        responseText += `Processing Time: ${data.processing_time_ms}ms\n`;
                        responseText += `Request ID: ${data.request_id}\n\n`;
                        responseText += `Full Response:\n${JSON.stringify(data, null, 2)}`;
                        
                        responseArea.textContent = responseText;
                        
                        if (data.downloadUrl) {
                            const downloadLink = document.getElementById('downloadLink');
                            downloadLink.href = data.downloadUrl;
                            downloadSection.classList.add('active');
                        }
                    } else {
                        responseArea.textContent = JSON.stringify(data, null, 2);
                        errorMessage.textContent = data.error?.message || 'Calculation failed';
                        errorMessage.classList.add('active');
                    }
                    
                    // Refresh file list
                    updateMetrics();
                }, 500);
                
            } catch (error) {
                clearInterval(progressInterval);
                loading.classList.remove('active');
                errorMessage.textContent = 'Failed to connect to API: ' + error.message;
                errorMessage.classList.add('active');
                responseArea.textContent = 'Error: ' + error.message;
            }
        }
        
        function fillRealisticValues() {
            // Reset all to example values from comprehensive form
            // Technical parameters
            document.getElementById('tech_D27_type').value = '1001';
            document.getElementById('tech_E27_weightType').value = 'Е-113';
            document.getElementById('tech_F27_quantityType').value = 'Целый ТА';
            document.getElementById('tech_G27_quantityType').value = 'К4-750';
            document.getElementById('tech_H27_quantityType').value = '1/6';
            document.getElementById('tech_I27_quantityType').value = '401';
            document.getElementById('tech_J27_quantityType').value = '22';
            document.getElementById('tech_K27_quantity').value = '23';
            document.getElementById('tech_L27_quantity').value = '101';
            document.getElementById('tech_M27_material').value = '102';
            document.getElementById('tech_P27_materialType').value = 'AISI 316L';
            document.getElementById('tech_R27_materialThicknessType').value = '09Г2С';
            document.getElementById('tech_S27_materialThicknessType').value = 'гофра';
            document.getElementById('tech_T27_materialThicknessType').value = '5';
            document.getElementById('tech_U27_materialThicknessType').value = '1';
            document.getElementById('tech_V27_thicknessType').value = '3';
            
            // Supply main parameters
            document.getElementById('sup_F2_parameter').value = '0000';
            document.getElementById('sup_D8_priceMaterial').value = '701';
            document.getElementById('sup_E8_priceMaterial').value = '702';
            if (document.getElementById('sup_D9_priceMaterial')) document.getElementById('sup_D9_priceMaterial').value = '09Г2С';
            if (document.getElementById('sup_D10_priceCostMaterial')) document.getElementById('sup_D10_priceCostMaterial').value = '1010';
            if (document.getElementById('sup_D11_priceCostMaterial')) document.getElementById('sup_D11_priceCostMaterial').value = '1011';
            document.getElementById('sup_K13_costQuantityNormTotal').value = '1';
            document.getElementById('sup_P13_costQuantityMaterialNorm').value = '120013';
            if (document.getElementById('sup_D17_priceWeightThickness')) document.getElementById('sup_D17_priceWeightThickness').value = '1017';
            document.getElementById('sup_D78_massThickness').value = '3';
            
            // Additional supply fields - only fill if they exist
            const fillIfExists = (id, value) => {
                const el = document.getElementById(id);
                if (el) el.value = value;
            };
            
            // Fill all additional supply fields with example values
            fillIfExists('sup_E19_priceWeightThicknessTotal', '1019');
            fillIfExists('sup_E20_priceWeightThicknessTotal', '1020');
            fillIfExists('sup_E21_priceWeightThicknessTotal', '1021');
            fillIfExists('sup_E25_priceWeightThicknessTotal', '1025');
            fillIfExists('sup_E26_priceWeightThickness', '1026');
            fillIfExists('sup_E27_priceWeightThickness', '1027');
            fillIfExists('sup_C28_priceWeightThickness', 'Ру10');
            fillIfExists('sup_C29_priceWeightPipeThickness', 'Ру40');
            fillIfExists('sup_D28_priceWeightThickness', 'Ду600');
            fillIfExists('sup_D29_priceWeightPipe', 'Ду600');
            fillIfExists('sup_F28_priceWeightThicknessTotal', '1028');
            fillIfExists('sup_F29_priceWeightPipeTotal', '1029');
            fillIfExists('sup_F30_priceWeightPipeTotal', '1030');
            fillIfExists('sup_F31_priceWeightPipeTotal', '1031');
            fillIfExists('sup_F32_priceWeightPipeTotal', '1032');
            fillIfExists('sup_F33_priceWeightPipeTotal', '1033');
            fillIfExists('sup_F39_priceQuantityWeightMaterialInsulationTotal', '2');
            fillIfExists('sup_D38_priceQuantityTotal', '1038');
            document.getElementById('sup_D43_priceTotal').value = '3301';
            document.getElementById('sup_D44_price').value = '1751';
            document.getElementById('sup_D45_price').value = '2801';
            document.getElementById('sup_D46_price').value = '1201';
        }
        
        function clearForm() {
            document.querySelectorAll('input[type="number"], input[type="text"]').forEach(input => {
                input.value = '';
            });
            document.querySelectorAll('select').forEach(select => {
                select.selectedIndex = 0;
            });
            document.getElementById('responseArea').textContent = 'Form cleared. Enter new values...';
            document.getElementById('downloadSection').classList.remove('active');
        }
        
        function updateFileList(files) {
            const fileList = document.getElementById('fileList');
            
            if (!files || files.length === 0) {
                fileList.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #718096;">
                        No files generated yet
                    </div>
                `;
                return;
            }
            
            fileList.innerHTML = files.slice(0, 10).map(file => `
                <div class="file-item">
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-meta">
                            ${new Date(file.created).toLocaleString()} • ${formatFileSize(file.size)}
                        </div>
                    </div>
                    <div class="file-actions">
                        <a href="${file.downloadUrl}" class="download-btn" download>Download</a>
                    </div>
                </div>
            `).join('');
        }
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        // Start monitoring
        updateMetrics();
        updateInterval = setInterval(updateMetrics, 5000);
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>